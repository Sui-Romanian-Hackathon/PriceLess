// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    Int      @id @default(autoincrement())
  user_id               String   @unique // ObjectID from Sui
  user_address          String   @unique // SuiAddress
  user_owner_address    String   @unique // Wallet address
  subscription_fee      BigInt   // u64 from Sui
  subscription_deadline BigInt   // u64 timestamp
  active                Boolean  // Active status
  registered_at         BigInt   // Registration timestamp

  // Relations
  buyOffers   BuyOffer[]
  manualBuys  ManualBuy[]

  @@index([user_owner_address])
  @@index([user_address])
  @@index([user_id])
  @@map("User")
}

model BuyOffer {
  id                        Int      @id @default(autoincrement())
  buy_offer_id              String   @unique // From Sui blockchain
  owner                     String   // Wallet address
  product                   String
  price                     BigInt   // Using BigInt for i64
  offer_type_is_time_based  Boolean
  deadline                  BigInt   // Timestamp
  created_at                BigInt   // Timestamp from blockchain

  // Relations
  user        User?        @relation(fields: [owner], references: [user_owner_address])
  sellOffers  SellOffer[]
  manualBuys  ManualBuy[]

  @@index([buy_offer_id])
  @@index([owner])
  @@index([product])
  @@map("BuyOffer")
}

model SellOffer {
  id              Int      @id @default(autoincrement())
  buy_offer_id    String
  sell_offer_id   String   @unique // From Sui blockchain
  agent_id        String
  agent_address   String   // Wallet address
  store_link      String
  price           BigInt   // Using BigInt for i64
  is_update       Boolean

  // Relations
  buyOffer      BuyOffer       @relation(fields: [buy_offer_id], references: [buy_offer_id])
  manualBuys    ManualBuy[]

  @@index([sell_offer_id])
  @@index([buy_offer_id])
  @@index([agent_id])
  @@index([agent_address])
  @@map("SellOffer")
}

model ManualBuy {
  id              Int      @id @default(autoincrement())
  buy_offer_id    String
  buyer           String   // Wallet address
  agent_id        String
  sell_offer_id   String
  store_link      String
  product_price   BigInt   // Using BigInt for i64
  agent_fee       BigInt
  total_paid      BigInt

  // Relations
  user       User?      @relation(fields: [buyer], references: [user_owner_address])
  buyOffer   BuyOffer   @relation(fields: [buy_offer_id], references: [buy_offer_id])
  sellOffer  SellOffer  @relation(fields: [sell_offer_id], references: [sell_offer_id])

  @@index([buy_offer_id])
  @@index([buyer])
  @@index([agent_id])
  @@index([sell_offer_id])
  @@map("ManualBuy")
}

model ShopPurchase {
  id            Int      @id @default(autoincrement())
  agent_id      String
  store_link    String
  product_price BigInt   // Using BigInt for i64
  agent_fee     BigInt
  platform_fee  BigInt

  @@index([agent_id])
  @@index([store_link])
  @@map("ShopPurchase")
}
